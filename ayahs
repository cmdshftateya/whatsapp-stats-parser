#! /usr/bin/env python3
import re
from datetime import datetime

def cleaner(filename):
    # Define the characters to be removed
    chars_to_remove = ['\u200d', '\u200e', '\u202a', '\u202c', '\xa0', '\U0001fae1']

    # Open the input file and read its contents
    with open(filename, 'r', encoding='utf-8') as file:
        input_text = file.read()

    # Remove the specified characters from the input text
    for char in chars_to_remove:
        input_text = input_text.replace(char, '')

    # Open the output file and write the modified text to it
    with open(filename, 'w', encoding='utf-8') as file:
        file.write(input_text)

def combiner(filename):
    with open(filename, 'r') as file:
        contents = file.readlines()

    pattern = r'\[(\d+/\d+/\d+, \d+:\d+:\d+ [AP]M)\]'
    messages = []

    for x in contents:
        if re.match(pattern, x):
            messages.append(x.rstrip('\n'))
        else:
            messages[-1] += x
    return messages

def separator(msgs):
    messages = []
    for msg in msgs:
        timestamp_str, content = msg.split("] ")
        date_str, time_str = timestamp_str[1:].split(", ")
        timestamp = datetime.strptime(date_str, "%m/%d/%y")
        sender, message = content.split(": ")
        messages.append({
            "timestamp": timestamp.strftime("%Y-%m-%d"),
            "sender": sender,
            "message": message
        })
    return messages

def ayah_finder(messages):
    ayah_messages = []
    ayah_text = "Ayah of the Day, "
    for message in messages:
        if ayah_text in message['message']:
            ayah_messages.append(message)
    return ayah_messages
        

# clean file
cleaner("mes7.txt")
messages = combiner("mes7.txt")
cleaned = separator(messages)
# ayahs = ayah_finder(messages)

print(cleaned)